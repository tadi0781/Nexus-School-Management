{# templates/partials/_social_comment_item.html - Nexus School Management System #}
{# Gemini 3 Pro Preview - Phase E.1 #}
{#
    Reusable item for displaying a single comment.
    Expects a `comment` object (e.g., ChannelComment or TalentClubFeedComment) and `current_user` in the context.
    - comment.author (User object)
    - comment.content
    - comment.timestamp
    - comment.id
    - comment.post_id (or comment.post.id)
#}
{% set commenter_name = comment.author.full_name or comment.author.username if comment.author else "Anonymous" %}
{% set commenter_avatar = url_for('static', filename=(comment.author.profile_photo_url if comment.author and comment.author.profile_photo_url else 'img/placeholders/user_avatar_default.png')) %}
{% set comment_post_type = 'channel_comment' if comment.post and comment.post.channel_id else ('tc_feed_comment' if comment.post and comment.post.feed_id else 'unknown_comment') %}

<div class="social-comment-item d-flex mb-2 pt-2 {% if loop.last %}pb-0{% else %}pb-2 border-bottom border-light-subtle{% endif %}" id="comment-{{ comment.id }}">
    <a href="#" class="me-2 flex-shrink-0"> {# Link to commenter's profile - placeholder #}
        <img src="{{ commenter_avatar }}" alt="{{ commenter_name }}" class="rounded-circle" style="width: 32px; height: 32px; object-fit: cover;">
    </a>
    <div class="flex-grow-1">
        <div class="comment-bubble bg-light-subtle p-2 rounded">
            <div class="d-flex justify-content-between align-items-center">
                <a href="#" class="text-decoration-none"> {# Link to commenter's profile - placeholder #}
                    <small class="fw-bold text-dark font-heading">{{ commenter_name }}</small>
                </a>
                {# Comment Actions Dropdown (Edit, Delete - for commenter or post/channel admins) #}
                {% if comment.author_id == current_user.id or (comment.post and comment.post.author_id == current_user.id) or (comment.post and comment.post.channel and current_user.get_channel_role(comment.post.channel) in ['owner', 'admin']) or (comment.post and comment.post.feed and comment.post.feed.talent_club and comment.post.feed.talent_club.owner_id == current_user.id) %}
                <div class="dropdown comment-actions ms-auto">
                    <button class="btn btn-sm btn-link text-muted py-0 px-1" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-three-dots"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                         {% if comment.author_id == current_user.id %}
                        <li><a class="dropdown-item edit-comment-btn" href="#" data-comment-id="{{ comment.id }}" data-post-id="{{ comment.post_id or comment.post.id }}"><i class="bi bi-pencil me-2"></i>Edit</a></li>
                        <li>
                            <button class="dropdown-item text-danger delete-comment-btn" data-comment-id="{{ comment.id }}" data-post-id="{{ comment.post_id or comment.post.id }}">
                                <i class="bi bi-trash me-2"></i>Delete
                            </button>
                        </li>
                        {% elif (comment.post and comment.post.author_id == current_user.id) or (comment.post and comment.post.channel and current_user.get_channel_role(comment.post.channel) in ['owner', 'admin']) or (comment.post and comment.post.feed and comment.post.feed.talent_club and comment.post.feed.talent_club.owner_id == current_user.id) %}
                         <li>
                            <button class="dropdown-item text-danger delete-comment-btn" data-comment-id="{{ comment.id }}" data-post-id="{{ comment.post_id or comment.post.id }}">
                                <i class="bi bi-trash me-2"></i>Delete (Admin)
                            </button>
                        </li>
                        {% endif %}
                    </ul>
                </div>
                {% endif %}
            </div>
            <p class="mb-0 comment-content-text text-dark-emphasis small" id="comment-content-{{ comment.id }}">{{ comment.content | nl2br | safe }}</p>
        </div>
        <small class="text-muted ms-1 comment-timestamp" title="{{ comment.timestamp | datetimeformat('%Y-%m-%d %H:%M:%S UTC') }}">
            {{ comment.timestamp | humanize_time_diff }}
        </small>
    </div>
</div>