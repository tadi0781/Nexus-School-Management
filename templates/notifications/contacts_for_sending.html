{% extends "layout/base.html" %}

{% block title %}Select Recipient{% endblock %}

{% block content_header %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2 font-heading">
        <i class="bi bi-person-plus-fill me-2 text-primary"></i>Select a Recipient
    </h1>
    <a href="{{ url_for('view_notifications') }}" class="btn btn-sm btn-outline-secondary">
        <i class="bi bi-x-circle me-1"></i>Cancel
    </a>
</div>
{% endblock %}

{% block content %}
<div class="container-fluid px-0">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-sm">
                <div class="card-header bg-light-subtle">
                    <h5 class="mb-0 font-heading">Choose a user to notify</h5>
                </div>
                <div class="card-body p-0">
                    {% if contacts %}
                        <div class="list-group list-group-flush">
                            {% for contact in contacts %}
                                {#
                                  FIX: The template now correctly includes the partial,
                                  passing the `target_route` context to ensure the link
                                  points to the notification form.
                                #}
                                {% include 'partials/_contact_list_item.html' with {'contact': contact, 'target_route': 'send_notification_to_user'} %}
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center p-4 text-muted">
                            <i class="bi bi-person-x-fill fs-1 mb-2"></i>
                            <p>There are no users you are permitted to send notifications to at this time.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}